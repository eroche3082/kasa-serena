Mega Prompt Completo para Implementar y Verificar el Flujo de Cotizaci贸n
 Objetivo:
Implementar el flujo de cotizaci贸n completo y verificar que todas las funcionalidades de la Fase 9 est茅n operativas:

Formulario de cotizaci贸n debe capturar y enviar datos correctamente.

Backend debe manejar correctamente las cotizaciones.

Visualizaci贸n de cotizaciones debe ser funcional en el Dashboard de Usuario.

Opciones de compartir por WhatsApp y enviar por email deben funcionar correctamente.

З PASO 1: Implementar Backend para las Cotizaciones
1.1 Verificar las rutas API para cotizaciones
Abre el archivo server/routes.ts y aseg煤rate de que las rutas API para cotizaciones est茅n registradas correctamente.

ts
Copiar
Editar
// Ruta para crear cotizaci贸n
app.post("/api/quotes", createQuote);

// Ruta para obtener cotizaciones del usuario
app.get("/api/quotes", getUserQuotes);
Verificar que la funci贸n createQuote est茅 implementada en server/quotes.ts para crear nuevas cotizaciones y asociarlas al proyecto correspondiente.

ts
Copiar
Editar
// Funci贸n para crear cotizaci贸n
export async function createQuote(req, res) {
  const { projectType, materials, dimensions, startDate, contactInfo } = req.body;
  // L贸gica para guardar la cotizaci贸n en la base de datos
  const newQuote = await saveQuoteToDatabase({ projectType, materials, dimensions, startDate, contactInfo });
  res.status(201).json({ message: "Cotizaci贸n recibida", quoteDetails: newQuote });
}
1.2 Verificar la funci贸n getUserQuotes
Verificar que el endpoint /api/quotes devuelva las cotizaciones del usuario correctamente.

ts
Copiar
Editar
// Funci贸n para obtener cotizaciones del usuario
export async function getUserQuotes(req, res) {
  const userId = req.user.id; // Obtenemos el ID del usuario desde la sesi贸n
  const quotes = await getQuotesFromDatabase(userId); // Recuperamos las cotizaciones del usuario
  res.status(200).json(quotes);
}
З PASO 2: Implementar el Formulario de Cotizaci贸n en el Frontend
2.1 Verificar el formulario de cotizaci贸n
Aseg煤rate de que el formulario en client/src/features/quotes/QuoteRequestForm.tsx tenga todos los campos necesarios:

Tipo de dise帽o

Materiales seleccionados

Dimensiones y especificaciones

Fecha estimada de ejecuci贸n

Informaci贸n de contacto adicional

tsx
Copiar
Editar
const QuoteRequestForm = () => {
  const [formData, setFormData] = useState({
    projectType: '',
    materials: [],
    dimensions: '',
    startDate: '',
    contactInfo: { name: '', email: '', phone: '' }
  });

  const handleSubmit = async (e) => {
    e.preventDefault();
    // Llamar a la API para enviar la cotizaci贸n
    await submitQuote(formData);
  };

  return (
    <form onSubmit={handleSubmit}>
      <input type="text" name="projectType" placeholder="Tipo de proyecto" required />
      <textarea name="materials" placeholder="Materiales seleccionados" required />
      <input type="text" name="dimensions" placeholder="Dimensiones" required />
      <input type="date" name="startDate" required />
      <input type="text" name="contactName" placeholder="Nombre" required />
      <input type="email" name="contactEmail" placeholder="Email" required />
      <input type="tel" name="contactPhone" placeholder="Tel茅fono" required />
      <button type="submit">Solicitar Cotizaci贸n</button>
    </form>
  );
};
2.2 Conectar el formulario con el backend
Aseg煤rate de que el submit del formulario est茅 llamando correctamente al backend para crear la cotizaci贸n.

tsx
Copiar
Editar
const submitQuote = async (formData) => {
  try {
    const response = await fetch('/api/quotes', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(formData)
    });

    const data = await response.json();
    if (response.ok) {
      // Mostrar mensaje de 茅xito o redirigir al usuario
      alert('Cotizaci贸n enviada con 茅xito');
    } else {
      // Manejar errores
      alert('Hubo un error al enviar la cotizaci贸n');
    }
  } catch (error) {
    alert('Error de conexi贸n');
  }
};
З PASO 3: Implementar Opciones de Contacto
3.1 Enviar cotizaci贸n por WhatsApp
Aseg煤rate de que el enlace para compartir cotizaci贸n por WhatsApp est茅 funcionando correctamente:

tsx
Copiar
Editar
<a
  href={`https://wa.me/1XXXXXXXXXX?text=Me gustar铆a recibir una cotizaci贸n para este proyecto: ${encodeURIComponent(projectDetails)}`}
  target="_blank"
  rel="noopener noreferrer"
>
  <button>Compartir Cotizaci贸n por WhatsApp</button>
</a>
3.2 Enviar cotizaci贸n por email
Verifica que el correo de cotizaci贸n se env铆e correctamente desde el backend utilizando Nodemailer.

ts
Copiar
Editar
const sendQuoteEmail = (email, projectDetails) => {
  const mailOptions = {
    from: process.env.EMAIL_USER,
    to: email,
    subject: "Cotizaci贸n de Proyecto",
    text: `Detalles del proyecto: ${JSON.stringify(projectDetails)}`,
  };
  transporter.sendMail(mailOptions, (error, info) => {
    if (error) {
      console.log(error);
    } else {
      console.log("Email enviado: " + info.response);
    }
  });
};
З PASO 4: Implementar Visualizaci贸n de Cotizaciones en el Dashboard
4.1 Mostrar cotizaciones en el Dashboard
Aseg煤rate de que las cotizaciones se muestren correctamente en el Dashboard de Usuario.

tsx
Copiar
Editar
const CotizacionesSection = () => {
  const [cotizaciones, setCotizaciones] = useState([]);
  // Obtener cotizaciones del backend

  useEffect(() => {
    const fetchCotizaciones = async () => {
      const response = await fetch('/api/quotes');
      const data = await response.json();
      setCotizaciones(data);
    };
    fetchCotizaciones();
  }, []);

  return (
    <div>
      <h3>Mis Cotizaciones</h3>
      <ul>
        {cotizaciones.map((cotizacion) => (
          <li key={cotizacion.id}>
            <p>{cotizacion.projectType}</p>
            <p>{cotizacion.status}</p>
            <button>Ver Cotizaci贸n</button>
          </li>
        ))}
      </ul>
    </div>
  );
};
З PASO 5: Verificaci贸n Final
5.1 Verificar que la cotizaci贸n se guarda correctamente en la base de datos
Aseg煤rate de que las cotizaciones se asocien correctamente al proyecto del usuario y se muestren en su dashboard.

5.2 Verificar el env铆o de cotizaci贸n por WhatsApp y email
Realiza pruebas para asegurarte de que los enlaces de WhatsApp y correo electr贸nico funcionan correctamente.

5.3 Verificar la visualizaci贸n de cotizaciones en el Dashboard
Verifica que las cotizaciones aparezcan con la informaci贸n correcta (tipo de proyecto, estado, etc.) en la secci贸n de Mis Cotizaciones.

 INSTRUCCIONES PARA EL AGENTE
 REPLY "YES" OR "NO" ONCE YOU COMPLETE AND VERIFY FASE 9.
 LOG FASE 9 AS COMPLETE IN /agent-checklist.
 UPLOAD A SCREENSHOT OF THE COTIZACION FORM, DASHBOARD, AND FUNCTIONALITIES TO /internal-map.

 Pr贸ximos pasos:
Una vez completada la Fase 9, pasaremos a la Fase 10: Seguridad, Deploy y Optimizaci贸n. Pero primero, verifiquemos que todo est茅 funcionando correctamente con las cotizaciones y el flujo de contacto.